## 최종 수정 방법 - 가장 안전하고 검증된 방법

### 방법 1: install-service-filebeat.ps1 최소 수정 (권장)

**파일명: install-service-filebeat.ps1**

```powershell
<#
.SYNOPSIS
    Installs Filebeat Windows service.
.DESCRIPTION
    Installs Filebeat Windows service, the data and logs path are
    set as part of the command for the service.

    For Filebeat < 9.1.0 the data path used to be
    'C:\ProgramData\Filebeat' (set from '$env:ProgramData) for >= 9.1.0
    the new default is 'C:\Program Files\Filebeat-Data'
    (set from '$env:ProgramFiles').

    If the legacy data path exists, then the script will move it to the new place,
    regardless of Filebeat version.

    You can pass ForceLegacyPath to use the legacy data path.

    If the Windows service already exists, it will be stopped and deleted, then
    the new one will be installed.
#>

Param (
  # Force the usage of the legacy ( < 9.1.0) data path.
  [switch]$ForceLegacyPath
)

# Delete and stop the service if it already exists.
if (Get-Service filebeat -ErrorAction SilentlyContinue) {
  Stop-Service filebeat
  (Get-Service filebeat).WaitForStatus('Stopped')
  Start-Sleep -s 1
  sc.exe delete filebeat
}

# D:\filebeat로 경로 변경 - 이 부분만 수정
$WorkDir = "D:\filebeat"  # 변경됨
$BasePath = "D:\filebeat\data"  # 변경됨
$LegacyDataPath = "$env:PROGRAMDATA\Filebeat"

# 디렉토리 생성 추가
if (!(Test-Path $BasePath)) {
    New-Item -ItemType Directory -Force -Path $BasePath
}

# Move the data path from ProgramData to Program Files
If ($ForceLegacyPath -eq $True) {
  $BasePath = $LegacyDataPath
} elseif (Test-Path $LegacyDataPath) {
    Write-Output "Files found at $LegacyDataPath, moving them to $BasePath"
  Try {
    Move-Item $LegacyDataPath $BasePath -ErrorAction Stop
  } Catch {
    Write-Output "Could not move $LegacyDataPath to $BasePath"
    Write-Output "make sure the folder can be moved or set -ForceLegacyPath"
    Write-Output "to force using $LegacyDataPath as the data path"
    Throw $_.Exception
  }
}

$HomePath = "$BasePath\Filebeat"
$LogsPath = "$HomePath\logs"
$KeystorePath = "$WorkDir\data\Filebeat.keystore"

$FullCmd = "`"$WorkDir\filebeat.exe`" " +
           "--environment=windows_service " +
           "-c `"$WorkDir\filebeat.yml`" " +
           "--path.home `"$WorkDir`" " +
           "--path.data `"$HomePath`" " +
           "--path.logs `"$LogsPath`" " +
           "-E keystore.path=`"$KeyStorePath`" " +
           "-E logging.files.redirect_stderr=true"

# Create the new service.
New-Service -name filebeat `
  -displayName Filebeat `
  -binaryPathName $FullCmd

# Attempt to set the service to delayed start using sc config.
Try {
  Start-Process -FilePath sc.exe -ArgumentList 'config filebeat start= delayed-auto'
}
Catch { Write-Host -f red "An error occurred setting the service to delayed start." }
```

### 실행 단계

```powershell
# 1. 기존 Filebeat 서비스 중지 (있다면)
Stop-Service filebeat -ErrorAction SilentlyContinue

# 2. D:\filebeat 디렉토리 생성
New-Item -ItemType Directory -Force -Path "D:\filebeat"

# 3. 기존 Filebeat 파일들을 D:\filebeat로 복사
Copy-Item -Path "C:\Program Files\Filebeat\*" -Destination "D:\filebeat\" -Recurse

# 4. D:\filebeat로 이동
cd D:\filebeat

# 5. PowerShell 관리자 권한으로 수정된 ps1 실행
.\install-service-filebeat.ps1

# 6. 서비스 시작
Start-Service filebeat

# 7. 상태 확인
Get-Service filebeat
```

### 방법 2: 원본 유지하고 심볼릭 링크 사용 (대안)

```powershell
# 관리자 권한 PowerShell에서 실행
# 1. D:\filebeat 디렉토리 생성
New-Item -ItemType Directory -Force -Path "D:\filebeat\data"

# 2. 심볼릭 링크 생성
New-Item -ItemType SymbolicLink -Path "$env:ProgramFiles\Filebeat-Data" -Target "D:\filebeat\data"

# 3. 원본 ps1 그대로 실행
cd "C:\Program Files\Filebeat"
.\install-service-filebeat.ps1
```

**요약:**
- **방법 1**: ps1 파일에서 경로 2줄만 수정 (WorkDir, BasePath)
- **방법 2**: 원본 파일 수정 없이 심볼릭 링크 활용
- 두 방법 모두 공식 문서 기반의 안전한 방법입니다
